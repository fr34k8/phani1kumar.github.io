!function(){function t(){this.name_counter=0,this.window_cache=null,this.output_handler=null,this.all_loaded=!1;var t=this;this.message_events=[],this.message_functions={start:[Z,nt,function(e){t._dispatch("start_callback",[e],{type:"start",properties:e})}],test_state:[J,rt,function(e){t._dispatch("test_state_callback",[e],{type:"test_state",test:e.structured_clone()})}],result:[tt,ot,function(e){t.output_handler.show_status(),t._dispatch("result_callback",[e],{type:"result",test:e.structured_clone()})}],completion:[et,at,function(e,s){var n=gt(e,function(t){return t.structured_clone()});t._dispatch("completion_callback",[e,s],{type:"complete",tests:n,status:s.structured_clone()})}]},y(window,"load",function(){t.all_loaded=!0})}function e(){this.name_counter=0,this.all_loaded=!0,this.message_list=[],this.message_ports=[]}function s(){e.call(this),this._add_message_port(self)}function n(){e.call(this);var t=this;self.addEventListener("connect",function(e){t._add_message_port(e.source)})}function r(){e.call(this),this.all_loaded=!1,this.on_loaded_callback=null;var t=this;self.addEventListener("message",function(e){e.data.type&&"connect"===e.data.type&&(e.ports&&e.ports[0]?(t._add_message_port(e.ports[0]),e.ports[0].start()):t._add_message_port(e.source))}),y(self,"install",function(e){t.all_loaded=!0,t.on_loaded_callback&&t.on_loaded_callback()})}function o(){if("document"in self)return new t;if("DedicatedWorkerGlobalScope"in self&&self instanceof DedicatedWorkerGlobalScope)return new s;if("SharedWorkerGlobalScope"in self&&self instanceof SharedWorkerGlobalScope)return new n;if("ServiceWorkerGlobalScope"in self&&self instanceof ServiceWorkerGlobalScope)return new r;if("WorkerGlobalScope"in self&&self instanceof WorkerGlobalScope)return new s;throw new Error("Unsupported test environment")}function a(t){return"SharedWorker"in self&&t instanceof SharedWorker}function i(t){return"ServiceWorker"in self&&t instanceof ServiceWorker}function u(t,e,s){var n=e?e:At.next_default_test_name();s=s?s:{};var r=new G(n,s);r.step(t,r,r),r.phase===r.phases.STARTED&&r.done()}function c(t,e,s){"function"!=typeof t&&(s=e,e=t,t=null);var n=e?e:At.next_default_test_name();s=s?s:{};var r=new G(n,s);return t&&r.step(t,r,r),r}function p(t,e,s){var n=c(e,s);n.step(function(){$t.promise_tests||($t.promise_tests=Promise.resolve())}),$t.promise_tests=$t.promise_tests.then(function(){return Promise.resolve(n.step(t,n,n)).then(function(){n.done()}).catch(n.step_func(function(t){if(t instanceof dt)throw t;ft(!1,"promise_test",null,"Unhandled rejection with value: ${value}",{value:t})}))})}function l(t,e,s,n){return s.then(t.unreached_func("Should have rejected: "+n)).catch(function(t){W(e,function(){throw t},n)})}function h(t,e,s){function n(){for(var t=0;t<s.length;t++)e.removeEventListener(s[t],o)}"string"==typeof s&&(s=[s]);for(var r=null,o=t.step_func(function(t){if(b(!!r,"Not expecting event, but got "+t.type+" event"),x(t.type,r.types[0],"Expected "+r.types[0]+" event, but got "+t.type+" event instead"),r.types.length>1)return void r.types.shift();var e=r.resolve;r=null,e(t)}),a=0;a<s.length;a++)e.addEventListener(s[a],o);return this.wait_for=function(t){return r?Promise.reject("Already waiting for an event or events"):("string"==typeof t&&(t=[t]),new Promise(function(e,s){r={types:t,resolve:e,reject:s}}))},t.add_cleanup(n),this}function _(t,e){var s=null,n={};2===arguments.length?(s=t,n=e):t instanceof Function?s=t:n=t,$t.setup(s,n),At.on_new_harness_properties(n)}function f(){0===$t.tests.length&&$t.set_file_is_test(),$t.file_is_test&&$t.tests[0].done(),$t.end_wait()}function d(t,e,s){vt(e,function(e,n){var r=e[0];u(function(){t.apply(this,e.slice(1))},r,Array.isArray(s)?s[n]:s)})}function y(t,e,s){t.addEventListener(e,s,!1)}function m(t,e){var s=this,n=Array.prototype.slice.call(arguments,2);return setTimeout(function(){t.apply(s,n)},e*$t.timeout_multiplier)}function g(t,e){return t.length>e?t.substring(0,e-3)+"...":t}function E(t){try{var e="nodeType"in t&&"nodeName"in t&&"nodeValue"in t&&"childNodes"in t}catch(t){return!1}if(e){try{t.nodeType}catch(t){return!1}return!0}return!1}function v(t,e){if(e||(e=[]),"object"==typeof t&&null!==t){if(e.indexOf(t)>=0)return"[...]";e.push(t)}if(Array.isArray(t))return"["+t.map(function(t){return v(t,e)}).join(", ")+"]";switch(typeof t){case"string":t=t.replace("\\","\\\\");for(var s in It){var n="\\"+It[s];t=t.replace(RegExp(String.fromCharCode(s),"g"),n)}return'"'+t.replace(/"/g,'\\"')+'"';case"boolean":case"undefined":return String(t);case"number":return t===-0&&1/t===-(1/0)?"-0":String(t);case"object":if(null===t)return"null";if(E(t))switch(t.nodeType){case Node.ELEMENT_NODE:for(var r="<"+t.localName,o=0;o<t.attributes.length;o++)r+=" "+t.attributes[o].name+'="'+t.attributes[o].value+'"';return r+=">"+t.innerHTML+"</"+t.localName+">","Element node "+g(r,60);case Node.TEXT_NODE:return'Text node "'+g(t.data,60)+'"';case Node.PROCESSING_INSTRUCTION_NODE:return"ProcessingInstruction node with target "+v(g(t.target,60))+" and data "+v(g(t.data,60));case Node.COMMENT_NODE:return"Comment node <!--"+g(t.data,60)+"-->";case Node.DOCUMENT_NODE:return"Document node with "+t.childNodes.length+(1==t.childNodes.length?" child":" children");case Node.DOCUMENT_TYPE_NODE:return"DocumentType node";case Node.DOCUMENT_FRAGMENT_NODE:return"DocumentFragment node with "+t.childNodes.length+(1==t.childNodes.length?" child":" children");default:return"Node object of unknown type"}default:try{return typeof t+' "'+g(String(t),1e3)+'"'}catch(t){return"[stringifying object threw "+String(t)+" with type "+String(typeof t)+"]"}}}function b(t,e){ft(t===!0,"assert_true",e,"expected true got ${actual}",{actual:t})}function w(t,e){ft(t===!1,"assert_false",e,"expected false got ${actual}",{actual:t})}function T(t,e){return e!==e?t!==t:0===t&&0===e?1/t===1/e:t===e}function x(t,e,s){return typeof t!=typeof e?void ft(!1,"assert_equals",s,"expected ("+typeof e+") ${expected} but got ("+typeof t+") ${actual}",{expected:e,actual:t}):void ft(T(t,e),"assert_equals",s,"expected ${expected} but got ${actual}",{expected:e,actual:t})}function S(t,e,s){ft(!T(t,e),"assert_not_equals",s,"got disallowed value ${actual}",{actual:t})}function R(t,e,s){ft(e.indexOf(t)!=-1,"assert_in_array",s,"value ${actual} not in array ${expected}",{actual:t,expected:e})}function O(t,e,s){function n(t,e,r){r.push(t);var o;for(o in t)ft(e.hasOwnProperty(o),"assert_object_equals",s,"unexpected property ${p}",{p:o}),"object"==typeof t[o]&&null!==t[o]?r.indexOf(t[o])===-1&&n(t[o],e[o],r):ft(T(t[o],e[o]),"assert_object_equals",s,"property ${p} expected ${expected} got ${actual}",{p:o,expected:e,actual:t});for(o in e)ft(t.hasOwnProperty(o),"assert_object_equals",s,"expected property ${p} missing",{p:o});r.pop()}n(t,e,[])}function k(t,e,s){ft(t.length===e.length,"assert_array_equals",s,"lengths differ, expected ${expected} got ${actual}",{expected:e.length,actual:t.length});for(var n=0;n<t.length;n++)ft(t.hasOwnProperty(n)===e.hasOwnProperty(n),"assert_array_equals",s,"property ${i}, property expected to be ${expected} but was ${actual}",{i:n,expected:e.hasOwnProperty(n)?"present":"missing",actual:t.hasOwnProperty(n)?"present":"missing"}),ft(T(e[n],t[n]),"assert_array_equals",s,"property ${i}, expected ${expected} but got ${actual}",{i:n,expected:e[n],actual:t[n]})}function N(t,e,s,n){ft("number"==typeof t,"assert_approx_equals",n,"expected a number but got a ${type_actual}",{type_actual:typeof t}),ft(Math.abs(t-e)<=s,"assert_approx_equals",n,"expected ${expected} +/- ${epsilon} but got ${actual}",{expected:e,actual:t,epsilon:s})}function A(t,e,s){ft("number"==typeof t,"assert_less_than",s,"expected a number but got a ${type_actual}",{type_actual:typeof t}),ft(t<e,"assert_less_than",s,"expected a number less than ${expected} but got ${actual}",{expected:e,actual:t})}function I(t,e,s){ft("number"==typeof t,"assert_greater_than",s,"expected a number but got a ${type_actual}",{type_actual:typeof t}),ft(t>e,"assert_greater_than",s,"expected a number greater than ${expected} but got ${actual}",{expected:e,actual:t})}function $(t,e,s,n){ft("number"==typeof t,"assert_between_exclusive",n,"expected a number but got a ${type_actual}",{type_actual:typeof t}),ft(t>e&&t<s,"assert_between_exclusive",n,"expected a number greater than ${lower} and less than ${upper} but got ${actual}",{lower:e,upper:s,actual:t})}function C(t,e,s){ft("number"==typeof t,"assert_less_than_equal",s,"expected a number but got a ${type_actual}",{type_actual:typeof t}),ft(t<=e,"assert_less_than_equal",s,"expected a number less than or equal to ${expected} but got ${actual}",{expected:e,actual:t})}function L(t,e,s){ft("number"==typeof t,"assert_greater_than_equal",s,"expected a number but got a ${type_actual}",{type_actual:typeof t}),ft(t>=e,"assert_greater_than_equal",s,"expected a number greater than or equal to ${expected} but got ${actual}",{expected:e,actual:t})}function M(t,e,s,n){ft("number"==typeof t,"assert_between_inclusive",n,"expected a number but got a ${type_actual}",{type_actual:typeof t}),ft(t>=e&&t<=s,"assert_between_inclusive",n,"expected a number greater than or equal to ${lower} and less than or equal to ${upper} but got ${actual}",{lower:e,upper:s,actual:t})}function P(t,e,s){ft(e.test(t),"assert_regexp_match",s,"expected ${expected} but got ${actual}",{expected:e,actual:t})}function D(t,e,s){x({}.toString.call(t),"[object "+e+"]",s)}function U(t){return function(e,s,n){ft(e.hasOwnProperty(s),t,n,"expected property ${p} missing",{p:s})}}function j(t,e,s){ft(!t.hasOwnProperty(e),"assert_not_exists",s,"unexpected property ${p} found",{p:e})}function q(t){return function(e,s,n){ft("object"==typeof e||"function"==typeof e,t,n,"provided value is not an object"),ft("hasOwnProperty"in e,t,n,"provided value is an object but has no hasOwnProperty method"),ft(!e.hasOwnProperty(s),t,n,"property ${p} found on object expected in prototype chain",{p:s}),ft(s in e,t,n,"property ${p} not found in prototype chain",{p:s})}}function H(t,e,s){var n=t[e];try{t[e]=n+"a",ft(T(t[e],n),"assert_readonly",s,"changing property ${p} succeeded",{p:e})}finally{t[e]=n}}function W(t,e,s){try{e.call(this),ft(!1,"assert_throws",s,"${func} did not throw",{func:e})}catch(u){if(u instanceof dt)throw u;if(null===t)return;if("object"==typeof t)return void ft("object"==typeof u&&"name"in u&&u.name==t.name,"assert_throws",s,"${func} threw ${actual} (${actual_name}) expected ${expected} (${expected_name})",{func:e,actual:u,actual_name:u.name,expected:t,expected_name:t.name});var n={INDEX_SIZE_ERR:"IndexSizeError",HIERARCHY_REQUEST_ERR:"HierarchyRequestError",WRONG_DOCUMENT_ERR:"WrongDocumentError",INVALID_CHARACTER_ERR:"InvalidCharacterError",NO_MODIFICATION_ALLOWED_ERR:"NoModificationAllowedError",NOT_FOUND_ERR:"NotFoundError",NOT_SUPPORTED_ERR:"NotSupportedError",INUSE_ATTRIBUTE_ERR:"InUseAttributeError",INVALID_STATE_ERR:"InvalidStateError",SYNTAX_ERR:"SyntaxError",INVALID_MODIFICATION_ERR:"InvalidModificationError",NAMESPACE_ERR:"NamespaceError",INVALID_ACCESS_ERR:"InvalidAccessError",TYPE_MISMATCH_ERR:"TypeMismatchError",SECURITY_ERR:"SecurityError",NETWORK_ERR:"NetworkError",ABORT_ERR:"AbortError",URL_MISMATCH_ERR:"URLMismatchError",QUOTA_EXCEEDED_ERR:"QuotaExceededError",TIMEOUT_ERR:"TimeoutError",INVALID_NODE_TYPE_ERR:"InvalidNodeTypeError",DATA_CLONE_ERR:"DataCloneError"},r=t in n?n[t]:t,o={IndexSizeError:1,HierarchyRequestError:3,WrongDocumentError:4,InvalidCharacterError:5,NoModificationAllowedError:7,NotFoundError:8,NotSupportedError:9,InUseAttributeError:10,InvalidStateError:11,SyntaxError:12,InvalidModificationError:13,NamespaceError:14,InvalidAccessError:15,TypeMismatchError:17,SecurityError:18,NetworkError:19,AbortError:20,URLMismatchError:21,QuotaExceededError:22,TimeoutError:23,InvalidNodeTypeError:24,DataCloneError:25,EncodingError:0,NotReadableError:0,UnknownError:0,ConstraintError:0,DataError:0,TransactionInactiveError:0,ReadOnlyError:0,VersionError:0,OperationError:0};if(!(r in o))throw new dt('Test bug: unrecognized DOMException code "'+t+'" passed to assert_throws()');var a={code:o[r]};(0===a.code||"object"==typeof u&&"name"in u&&u.name!==u.name.toUpperCase()&&"DOMException"!==u.name)&&(a.name=r),ft("object"==typeof u,"assert_throws",s,"${func} threw ${e} with type ${type}, not an object",{func:e,e:u,type:typeof u});for(var i in a)ft("object"==typeof u&&i in u&&u[i]==a[i],"assert_throws",s,"${func} threw ${e} that is not a DOMException "+t+": property ${prop} is equal to ${actual}, expected ${expected}",{func:e,e:u,prop:i,actual:u[i],expected:a[i]})}}function V(t){ft(!1,"assert_unreached",t,"Reached unreachable code")}function F(t,e,s){var n=[].slice.call(arguments,3),r=[],o=!1;if(vt(s,function(s){try{t.apply(this,[e,s].concat(n)),o=!0}catch(t){r.push(t.message)}}),!o)throw new dt(r.join("\n\n"))}function G(t,e){if($t.file_is_test&&$t.tests.length)throw new Error("Tried to create a test with file_is_test");this.name=t,this.phase=this.phases.INITIAL,this.status=this.NOTRUN,this.timeout_id=null,this.index=null,this.properties=e;var s=e.timeout?e.timeout:kt.test_timeout;null!==s?this.timeout_length=s*$t.timeout_multiplier:this.timeout_length=null,this.message=null,this.stack=null,this.steps=[],this.cleanup_callbacks=[],$t.push(this)}function B(t){var e=this;Object.keys(t).forEach(function(s){e[s]=t[s]}),this.index=null,this.phase=this.phases.INITIAL,this.update_state_from(t),$t.push(this)}function K(t){this.running=!0,this.tests=new Array;var e=this;t.onerror=function(t){e.worker_error(t)};var s;if(i(t))if(window.MessageChannel){var n=new MessageChannel;s=n.port1,s.start(),t.postMessage({type:"connect"},[n.port2])}else s=navigator.serviceWorker,t.postMessage({type:"connect"});else s=a(t)?t.port:t;this.worker=t,s.onmessage=function(t){e.running&&t.data.type in e.message_handlers&&e.message_handlers[t.data.type].call(e,t.data)}}function Y(){this.status=null,this.message=null,this.stack=null}function Q(){this.tests=[],this.num_pending=0,this.phases={INITIAL:0,SETUP:1,HAVE_TESTS:2,HAVE_RESULTS:3,COMPLETE:4},this.phase=this.phases.INITIAL,this.properties={},this.wait_for_finish=!1,this.processing_callbacks=!1,this.allow_uncaught_exception=!1,this.file_is_test=!1,this.timeout_multiplier=1,this.timeout_length=At.test_timeout(),this.timeout_id=null,this.start_callbacks=[],this.test_state_callbacks=[],this.test_done_callbacks=[],this.all_done_callbacks=[],this.pending_workers=[],this.status=new Y;var t=this;At.add_on_loaded_callback(function(){t.all_done()&&t.complete()}),this.set_timeout()}function X(t){$t.fetch_tests_from_worker(t)}function z(){null===$t.timeout_length&&$t.timeout()}function Z(t){$t.start_callbacks.push(t)}function J(t){$t.test_state_callbacks.push(t)}function tt(t){$t.test_done_callbacks.push(t)}function et(t){$t.all_done_callbacks.push(t)}function st(t,e){var s=t.indexOf(e);s>-1&&t.splice(s,1)}function nt(t){st($t.start_callbacks,t)}function rt(t){st($t.test_state_callbacks,t)}function ot(t){st($t.test_done_callbacks,t)}function at(t){st($t.all_done_callbacks,t)}function it(){this.output_document=document,this.output_node=null,this.enabled=kt.output,this.phase=this.INITIAL}function ut(t){return"string"==typeof t[0]}function ct(t,e){if("function"==typeof t){var s=t(e);return s?ct(s,e):null}return ut(t)?pt(t,e):mt(gt(t,function(t){return ct(t,e)}),function(t){return null!==t})}function pt(t,e){function s(t){for(var s=t.split(o),n=[],r=0;r<s.length;r+=2)n.push(s[r]),s[r+1]&&n.push(String(e[s[r+1]]));return n}function n(e,n){n[1]={};for(var r in t[1])if(e.hasOwnProperty(r)){var o=s(r).join(""),a=s(e[r]).join("");n[1][o]=a}}function r(t,n){for(var r=0;r<t.length;r++)if(t[r]instanceof Object){var o=ct(t[r],e);null!==o&&(ut(o)?n.push(o):Et(n,o))}else Et(n,s(String(t[r])));return n}var o=/\$\{([^ }]*)\}/g,a=[];return a.push(s(String(t[0])).join("")),"{text}"===t[0]?r(t.slice(1),a):(n(t[1],a),r(t.slice(2),a)),a}function lt(t,e){var s,n=e||document;if("{text}"===t[0]){s=n.createTextNode("");for(var r=1;r<t.length;r++)s.data+=t[r]}else{s=n.createElementNS(Nt,t[0]);for(var o in t[1])t[1].hasOwnProperty(o)&&s.setAttribute(o,t[1][o]);for(var r=2;r<t.length;r++)if(t[r]instanceof Object){var a=ht(t[r]);s.appendChild(a)}else{var i=n.createTextNode(t[r]);s.appendChild(i)}}return s}function ht(t,e,s){return ut(t)?lt(t,s):gt(t,function(t){return lt(t,s)})}function _t(t,e,s){return ht(ct(t,e),s)}function ft(t,e,s,n,r){if(0===$t.tests.length&&$t.set_file_is_test(),t!==!0){var o=yt(e,s,n,r);throw new dt(o)}}function dt(t){this.message=t,this.stack=this.get_stack()}function yt(t,e,s,n){for(var r in n)n.hasOwnProperty(r)&&(n[r]=v(n[r]));var o=ct(["{text}","${function_name}: ${description}"+s],bt({function_name:t,description:e?e+" ":""},n));return o.slice(1).join("")}function mt(t,e,s){for(var n=[],r=0;r<t.length;r++)if(t.hasOwnProperty(r)){var o=e.call(s,t[r],r,t);o&&n.push(t[r])}return n}function gt(t,e,s){var n=[];n.length=t.length;for(var r=0;r<t.length;r++)t.hasOwnProperty(r)&&(n[r]=e.call(s,t[r],r,t));return n}function Et(t,e){Array.prototype.push.apply(t,e)}function vt(t,e,s){for(var n=0;n<t.length;n++)t.hasOwnProperty(n)&&e.call(s,t[n],n,t)}function bt(t,e){var s,n={};for(s in t)n[s]=t[s];for(s in e)n[s]=e[s];return n}function wt(t,e){for(var s=e.split("."),n=At.global_scope(),r=0;r<s.length-1;r++)s[r]in n||(n[s[r]]={}),n=n[s[r]];n[s[s.length-1]]=t}function Tt(t){try{return!0}catch(t){return!1}}function xt(){if("document"in self)for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var s;t[e].src?s=t[e].src:t[e].href&&(s=t[e].href.baseVal);var n=s&&s.match(/^(.*\/|)testharness\.js$/);if(n)return s}}function St(){var t=xt();return t?t.slice(0,t.lastIndexOf("/")+1):void 0}function Rt(t){var e,s;try{s=typeof t.postMessage,e="function"===s||"object"===s}catch(t){e=!1}return e}var Ot=!1,kt={output:!0,harness_timeout:{normal:1e4,long:6e4},test_timeout:null,message_events:["start","test_state","result","completion"]},Nt="http://www.w3.org/1999/xhtml";t.prototype._dispatch=function(t,e,s){this._forEach_windows(function(n,r){if(r){try{var o=t in n}catch(t){o=!1}if(o)try{n[t].apply(void 0,e)}catch(t){if(Ot)throw t}}Rt(n)&&n!==self&&n.postMessage(s,"*")})},t.prototype._forEach_windows=function(t){var e=this.window_cache;if(!e){e=[[self,!0]];for(var s,n=self,r=0,o=location.ancestorOrigins;n!=n.parent;)n=n.parent,s=o?location.origin==o[r]:Tt(n),e.push([n,s]),r++;n=window.opener,n&&e.push([n,Tt(n)]),this.window_cache=e}vt(e,function(e){t.apply(null,e)})},t.prototype.on_tests_ready=function(){var t=new it;this.output_handler=t;var e=this;Z(function(t){e.output_handler.init(t)}),J(function(t){e.output_handler.show_status()}),tt(function(t){e.output_handler.show_status()}),et(function(t,s){e.output_handler.show_results(t,s)}),this.setup_messages(kt.message_events)},t.prototype.setup_messages=function(t){var e=this;vt(kt.message_events,function(s){var n=e.message_events.indexOf(s)!==-1,r=t.indexOf(s)!==-1;!n&&r?e.message_functions[s][0](e.message_functions[s][2]):n&&!r&&e.message_functions[s][1](e.message_functions[s][2])}),this.message_events=t},t.prototype.next_default_test_name=function(){var t=document.getElementsByTagName("title")[0],e=t&&t.firstChild&&t.firstChild.data||"Untitled",s=this.name_counter>0?" "+this.name_counter:"";return this.name_counter++,e+s},t.prototype.on_new_harness_properties=function(t){this.output_handler.setup(t),t.hasOwnProperty("message_events")&&this.setup_messages(t.message_events)},t.prototype.add_on_loaded_callback=function(t){y(window,"load",t)},t.prototype.test_timeout=function(){for(var t=document.getElementsByTagName("meta"),e=0;e<t.length;e++)if("timeout"==t[e].name){if("long"==t[e].content)return kt.harness_timeout.long;break}return kt.harness_timeout.normal},t.prototype.global_scope=function(){return window},e.prototype._dispatch=function(t){this.message_list.push(t);for(var e=0;e<this.message_ports.length;++e)this.message_ports[e].postMessage(t)},e.prototype._add_message_port=function(t){this.message_ports.push(t);for(var e=0;e<this.message_list.length;++e)t.postMessage(this.message_list[e])},e.prototype.next_default_test_name=function(){var t=this.name_counter>0?" "+this.name_counter:"";return this.name_counter++,"Untitled"+t},e.prototype.on_new_harness_properties=function(){},e.prototype.on_tests_ready=function(){var t=this;Z(function(e){t._dispatch({type:"start",properties:e})}),J(function(e){t._dispatch({type:"test_state",test:e.structured_clone()})}),tt(function(e){t._dispatch({type:"result",test:e.structured_clone()})}),et(function(e,s){t._dispatch({type:"complete",tests:gt(e,function(t){return t.structured_clone()}),status:s.structured_clone()})})},e.prototype.add_on_loaded_callback=function(){},e.prototype.test_timeout=function(){return null},e.prototype.global_scope=function(){return self},s.prototype=Object.create(e.prototype),s.prototype.on_tests_ready=function(){e.prototype.on_tests_ready.call(this),$t.wait_for_finish=!0},n.prototype=Object.create(e.prototype),n.prototype.on_tests_ready=function(){e.prototype.on_tests_ready.call(this),$t.wait_for_finish=!0},r.prototype=Object.create(e.prototype),r.prototype.add_on_loaded_callback=function(t){this.all_loaded?t():this.on_loaded_callback=t};var At=o();wt(h,"EventWatcher"),wt(u,"test"),wt(c,"async_test"),wt(p,"promise_test"),wt(l,"promise_rejects"),wt(d,"generate_tests"),wt(_,"setup"),wt(f,"done"),wt(y,"on_event"),wt(m,"step_timeout");var It={0:"0",1:"x01",2:"x02",3:"x03",4:"x04",5:"x05",6:"x06",7:"x07",8:"b",9:"t",10:"n",11:"v",12:"f",13:"r",14:"x0e",15:"x0f",16:"x10",17:"x11",18:"x12",19:"x13",20:"x14",21:"x15",22:"x16",23:"x17",24:"x18",25:"x19",26:"x1a",27:"x1b",28:"x1c",29:"x1d",30:"x1e",31:"x1f","0xfffd":"ufffd","0xfffe":"ufffe","0xffff":"uffff"};wt(v,"format_value"),wt(b,"assert_true"),wt(w,"assert_false"),wt(x,"assert_equals"),wt(S,"assert_not_equals"),wt(R,"assert_in_array"),wt(O,"assert_object_equals"),wt(k,"assert_array_equals"),wt(N,"assert_approx_equals"),wt(A,"assert_less_than"),wt(I,"assert_greater_than"),wt($,"assert_between_exclusive"),wt(C,"assert_less_than_equal"),wt(L,"assert_greater_than_equal"),wt(M,"assert_between_inclusive"),wt(P,"assert_regexp_match"),wt(D,"assert_class_string"),wt(U("assert_exists"),"assert_exists"),wt(U("assert_own_property"),"assert_own_property"),wt(j,"assert_not_exists"),wt(q("assert_inherits"),"assert_inherits"),wt(q("assert_idl_attribute"),"assert_idl_attribute"),wt(H,"assert_readonly"),wt(W,"assert_throws"),wt(V,"assert_unreached"),wt(F,"assert_any"),G.statuses={PASS:0,FAIL:1,TIMEOUT:2,NOTRUN:3},G.prototype=bt({},G.statuses),G.prototype.phases={INITIAL:0,STARTED:1,HAS_RESULT:2,COMPLETE:3},G.prototype.structured_clone=function(){if(!this._structured_clone){var t=this.message;t=t?String(t):t,this._structured_clone=bt({name:String(this.name),properties:bt({},this.properties)},G.statuses)}return this._structured_clone.status=this.status,this._structured_clone.message=this.message,this._structured_clone.stack=this.stack,this._structured_clone.index=this.index,this._structured_clone},G.prototype.step=function(t,e){if(!(this.phase>this.phases.STARTED)){this.phase=this.phases.STARTED,this.set_status(this.TIMEOUT,"Test timed out"),$t.started=!0,$t.notify_test_state(this),null===this.timeout_id&&this.set_timeout(),this.steps.push(t),1===arguments.length&&(e=this);try{return t.apply(e,Array.prototype.slice.call(arguments,2))}catch(t){if(this.phase>=this.phases.HAS_RESULT)return;var s=String("object"==typeof t&&null!==t?t.message:t),n=t.stack?t.stack:null;this.set_status(this.FAIL,s,n),this.phase=this.phases.HAS_RESULT,this.done()}}},G.prototype.step_func=function(t,e){var s=this;return 1===arguments.length&&(e=s),function(){return s.step.apply(s,[t,e].concat(Array.prototype.slice.call(arguments)))}},G.prototype.step_func_done=function(t,e){var s=this;return 1===arguments.length&&(e=s),function(){t&&s.step.apply(s,[t,e].concat(Array.prototype.slice.call(arguments))),s.done()}},G.prototype.unreached_func=function(t){return this.step_func(function(){V(t)})},G.prototype.step_timeout=function(t,e){var s=this,n=Array.prototype.slice.call(arguments,2);return setTimeout(this.step_func(function(){return t.apply(s,n)}),e*$t.timeout_multiplier)},G.prototype.add_cleanup=function(t){this.cleanup_callbacks.push(t)},G.prototype.force_timeout=function(){this.set_status(this.TIMEOUT),this.phase=this.phases.HAS_RESULT},G.prototype.set_timeout=function(){if(null!==this.timeout_length){var t=this;this.timeout_id=setTimeout(function(){t.timeout()},this.timeout_length)}},G.prototype.set_status=function(t,e,s){this.status=t,this.message=e,this.stack=s?s:null},G.prototype.timeout=function(){this.timeout_id=null,this.set_status(this.TIMEOUT,"Test timed out"),this.phase=this.phases.HAS_RESULT,this.done()},G.prototype.done=function(){this.phase!=this.phases.COMPLETE&&(this.phase<=this.phases.STARTED&&this.set_status(this.PASS,null),this.phase=this.phases.COMPLETE,clearTimeout(this.timeout_id),$t.result(this),this.cleanup())},G.prototype.cleanup=function(){vt(this.cleanup_callbacks,function(t){t()})},B.prototype.structured_clone=function(){var t={};return Object.keys(this).forEach(function(e){"object"==typeof this[e]?t[e]=bt({},this[e]):t[e]=this[e]}.bind(this)),t.phases=bt({},this.phases),t},B.prototype.cleanup=function(){},B.prototype.phases=G.prototype.phases,B.prototype.update_state_from=function(t){this.status=t.status,this.message=t.message,this.stack=t.stack,this.phase===this.phases.INITIAL&&(this.phase=this.phases.STARTED)},B.prototype.done=function(){this.phase=this.phases.COMPLETE},K.prototype.worker_error=function(t){var e=t.message||String(t),s=t.filename?" "+t.filename:"";this.worker_done({status:{status:$t.status.ERROR,message:"Error in worker"+s+": "+e,stack:t.stack}}),t.preventDefault()},K.prototype.test_state=function(t){var e=this.tests[t.test.index];e||(e=new B(t.test),this.tests[t.test.index]=e),e.update_state_from(t.test),$t.notify_test_state(e)},K.prototype.test_done=function(t){var e=this.tests[t.test.index];e.update_state_from(t.test),e.done(),$t.result(e)},K.prototype.worker_done=function(t){null===$t.status.status&&t.status.status!==t.status.OK&&($t.status.status=t.status.status,$t.status.message=t.status.message,$t.status.stack=t.status.stack),this.running=!1,this.worker=null,$t.all_done()&&$t.complete()},K.prototype.message_handlers={test_state:K.prototype.test_state,result:K.prototype.test_done,complete:K.prototype.worker_done},Y.statuses={OK:0,ERROR:1,TIMEOUT:2},Y.prototype=bt({},Y.statuses),Y.prototype.structured_clone=function(){if(!this._structured_clone){var t=this.message;t=t?String(t):t,this._structured_clone=bt({status:this.status,message:t,stack:this.stack},Y.statuses)}return this._structured_clone},Q.prototype.setup=function(t,e){if(!(this.phase>=this.phases.HAVE_RESULTS)){this.phase<this.phases.SETUP&&(this.phase=this.phases.SETUP),this.properties=e;for(var s in e)if(e.hasOwnProperty(s)){var n=e[s];"allow_uncaught_exception"==s?this.allow_uncaught_exception=n:"explicit_done"==s&&n?this.wait_for_finish=!0:"explicit_timeout"==s&&n?(this.timeout_length=null,this.timeout_id&&clearTimeout(this.timeout_id)):"timeout_multiplier"==s&&(this.timeout_multiplier=n)}if(t)try{t()}catch(t){this.status.status=this.status.ERROR,this.status.message=String(t),this.status.stack=t.stack?t.stack:null}this.set_timeout()}},Q.prototype.set_file_is_test=function(){if(this.tests.length>0)throw new Error("Tried to set file as test after creating a test");this.wait_for_finish=!0,this.file_is_test=!0,c()},Q.prototype.set_timeout=function(){var t=this;clearTimeout(this.timeout_id),null!==this.timeout_length&&(this.timeout_id=setTimeout(function(){t.timeout()},this.timeout_length))},Q.prototype.timeout=function(){null===this.status.status&&(this.status.status=this.status.TIMEOUT),this.complete()},Q.prototype.end_wait=function(){this.wait_for_finish=!1,this.all_done()&&this.complete()},Q.prototype.push=function(t){this.phase<this.phases.HAVE_TESTS&&this.start(),this.num_pending++,t.index=this.tests.push(t),this.notify_test_state(t)},Q.prototype.notify_test_state=function(t){var e=this;vt(this.test_state_callbacks,function(s){s(t,e)})},Q.prototype.all_done=function(){return this.tests.length>0&&At.all_loaded&&0===this.num_pending&&!this.wait_for_finish&&!this.processing_callbacks&&!this.pending_workers.some(function(t){return t.running})},Q.prototype.start=function(){this.phase=this.phases.HAVE_TESTS,this.notify_start()},Q.prototype.notify_start=function(){var t=this;vt(this.start_callbacks,function(e){e(t.properties)})},Q.prototype.result=function(t){this.phase>this.phases.HAVE_RESULTS||(this.phase=this.phases.HAVE_RESULTS,this.num_pending--,this.notify_result(t))},Q.prototype.notify_result=function(t){var e=this;this.processing_callbacks=!0,vt(this.test_done_callbacks,function(s){s(t,e)}),this.processing_callbacks=!1,e.all_done()&&e.complete()},Q.prototype.complete=function(){if(this.phase!==this.phases.COMPLETE){this.phase=this.phases.COMPLETE;var t=this;this.tests.forEach(function(e){e.phase<e.phases.COMPLETE&&(t.notify_result(e),e.cleanup(),e.phase=e.phases.COMPLETE)}),this.notify_complete()}},Q.prototype.notify_complete=function(){var t=this;null===this.status.status&&(this.status.status=this.status.OK),vt(this.all_done_callbacks,function(e){e(t.tests,t.status)})},Q.prototype.fetch_tests_from_worker=function(t){this.phase>=this.phases.COMPLETE||this.pending_workers.push(new K(t))},wt(X,"fetch_tests_from_worker"),wt(z,"timeout"),wt(Z,"add_start_callback"),wt(J,"add_test_state_callback"),wt(tt,"add_result_callback"),wt(et,"add_completion_callback"),it.prototype.INITIAL=0,it.prototype.STARTED=1,it.prototype.HAVE_RESULTS=2,it.prototype.COMPLETE=3,it.prototype.setup=function(t){this.phase>this.INITIAL||(this.enabled=this.enabled&&(t.hasOwnProperty("output")?t.output:kt.output))},it.prototype.init=function(t){this.phase>=this.STARTED||(t.output_document?this.output_document=t.output_document:this.output_document=document,this.phase=this.STARTED)},it.prototype.resolve_log=function(){var t;if(t="function"==typeof this.output_document?this.output_document.apply(void 0):this.output_document){var e=t.getElementById("log");if(!e){if(!document.body||"loading"==document.readyState)return;e=t.createElement("div"),e.id="log",t.body.appendChild(e)}this.output_document=t,this.output_node=e}},it.prototype.show_status=function(){if(this.phase<this.STARTED&&this.init(),this.enabled){this.phase<this.HAVE_RESULTS&&(this.resolve_log(),this.phase=this.HAVE_RESULTS);var t=$t.tests.length-$t.num_pending;this.output_node&&(t<100||t<1e3&&t%100===0||t%1e3===0)&&(this.output_node.textContent="Running, "+t+" complete, "+$t.num_pending+" remain")}},it.prototype.show_results=function(t,e){function s(t){return t.replace(/\s/g,"").toLowerCase()}function n(t){return t.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function r(){for(var e=0;e<t.length;e++)if(t[e].properties.hasOwnProperty("assert"))return!0;return!1}function o(t){return t.properties.hasOwnProperty("assert")?Array.isArray(t.properties.assert)?t.properties.assert.join(" "):t.properties.assert:""}if(!(this.phase>=this.COMPLETE)&&this.enabled){this.output_node||this.resolve_log(),this.phase=this.COMPLETE;var a=this.output_node;if(a){for(var i=this.output_document;a.lastChild;)a.removeChild(a.lastChild);var u=St();if(null!==u){var c=i.createElementNS(Nt,"link");c.setAttribute("rel","stylesheet"),c.setAttribute("href",u+"testharness.css");var p=i.getElementsByTagName("head");p.length&&p[0].appendChild(c)}var l={};l[e.OK]="OK",l[e.ERROR]="Error",l[e.TIMEOUT]="Timeout";var h={};h[G.prototype.PASS]="Pass",h[G.prototype.FAIL]="Fail",h[G.prototype.TIMEOUT]="Timeout",h[G.prototype.NOTRUN]="Not Run";var _={};vt(t,function(t){var e=h[t.status];_.hasOwnProperty(e)?_[e]+=1:_[e]=1});var f=["section",{id:"summary"},["h2",{},"Summary"],function(){var t=l[e.status],n=[["section",{},["p",{},"Harness status: ",["span",{
class:s(t)},t]]]];return e.status===e.ERROR&&(n[0].push(["pre",{},e.message]),e.stack&&n[0].push(["pre",{},e.stack])),n},["p",{},"Found ${num_tests} tests"],function(){for(var t=[["div",{}]],e=0;h.hasOwnProperty(e);){if(_.hasOwnProperty(h[e])){var n=h[e];t[0].push(["div",{class:s(n)},["label",{},["input",{type:"checkbox",checked:"checked"}],_[n]+" "+n]])}e++}return t}];a.appendChild(_t(f,{num_tests:t.length},i)),vt(i.querySelectorAll("section#summary label"),function(t){y(t,"click",function(e){if(null===i.getElementById("results"))return void e.preventDefault();var s=t.parentNode.getAttribute("class"),n=i.querySelector("style#hide-"+s),r=t.querySelector("input");n||r.checked?n&&r.checked&&n.parentNode.removeChild(n):(n=i.createElementNS(Nt,"style"),n.id="hide-"+s,n.textContent="table#results > tbody > tr."+s+"{display:none}",i.body.appendChild(n))})}),a.appendChild(document.createElementNS(Nt,"section"));for(var d=r(),m="<h2>Details</h2><table id='results' "+(d?"class='assertions'":"")+"><thead><tr><th>Result</th><th>Test Name</th>"+(d?"<th>Assertion</th>":"")+"<th>Message</th></tr></thead><tbody>",g=0;g<t.length;g++)m+='<tr class="'+n(s(h[t[g].status]))+'"><td>'+n(h[t[g].status])+"</td><td>"+n(t[g].name)+"</td><td>"+(d?n(o(t[g]))+"</td><td>":"")+n(t[g].message?t[g].message:" ")+(t[g].stack?"<pre>"+n(t[g].stack)+"</pre>":"")+"</td></tr>";m+="</tbody></table>";try{a.lastChild.innerHTML=m}catch(t){a.appendChild(document.createElementNS(Nt,"p")).textContent="Setting innerHTML for the log threw an exception.",a.appendChild(document.createElementNS(Nt,"pre")).textContent=m}}}},dt.prototype=Object.create(Error.prototype),dt.prototype.get_stack=function(){var t=(new Error).stack;if(!t)try{throw new Error}catch(e){t=e.stack}for(var e=t.split("\n"),s=xt(),n=s?s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"):"\\btestharness.js",r=new RegExp(n+":\\d+:\\d+"),o=0;!r.test(e[o])&&o<e.length;)o++;for(;r.test(e[o])&&o<e.length;)o++;return o>=e.length?t:e.slice(o).join("\n")};var $t=new Q;addEventListener("error",function(t){if($t.file_is_test){var e=$t.tests[0];if(e.phase>=e.phases.HAS_RESULT)return;e.set_status(e.FAIL,t.message,t.stack),e.phase=e.phases.HAS_RESULT,e.done(),f()}else $t.allow_uncaught_exception||($t.status.status=$t.status.ERROR,$t.status.message=t.message,$t.status.stack=t.stack)}),At.on_tests_ready()}();