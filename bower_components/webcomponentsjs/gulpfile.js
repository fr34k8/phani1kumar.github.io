"use strict";function defineBuildTask(e,r){!function(){r=r||"./src/"+e+"/build.json";var i=e,n=readManifest(r);gulp.task(e+"-debug",["version"],function(){return gulp.src(n).pipe(concat(i+".js")).pipe(uglify({mangle:!1,compress:!1,output:{beautify:!0,indent_level:2}})).pipe(header(banner,{pkg:pkg})).pipe(gulp.dest("dist/"))}),gulp.task(e,["version",e+"-debug"],function(){return gulp.src(n).pipe(concat(i+".min.js")).pipe(uglify()).pipe(header(banner,{pkg:pkg})).pipe(gulp.dest("dist/"))})}()}function readJSON(e){var r=fs.readFileSync(e,"utf8");return JSON.parse(r)}function readManifest(e,r){r=r||[];var i=readJSON(e),n=path.dirname(e);i.forEach(function(e){var i=path.join(n,e);".json"==e.slice(-5)?r=r.concat(readManifest(i,r)):r.push(i)});for(var u=Object.create(null),t=0;t<r.length;t++)u[r[t]]=1;return r=Object.keys(u)}var audit=require("gulp-audit"),concat=require("gulp-concat"),exec=require("child_process").exec,fs=require("fs"),gulp=require("gulp"),header=require("gulp-header"),path=require("path"),rename=require("gulp-rename"),runseq=require("run-sequence"),uglify=require("gulp-uglify");require("web-component-tester").gulp.init(gulp);var isRelease=void 0!==process.env.RELEASE,banner=fs.readFileSync("banner.txt","utf8"),pkg;gulp.task("audit",function(){return gulp.src("dist/*.js").pipe(audit("build.log",{repos:["."]})).pipe(gulp.dest("dist/"))}),gulp.task("version",function(e){pkg=require("./package.json");var r=["git","rev-parse","--short","HEAD"].join(" ");isRelease?e():exec(r,function(r,i,n){return r?e(r):(i&&(i=i.trim()),pkg.version=pkg.version+"-"+i,void e())})}),gulp.task("copy-bower",function(){return gulp.src(["bower.json","package.json","README.md"]).pipe(gulp.dest("dist/"))}),defineBuildTask("webcomponents","./src/build.json"),defineBuildTask("webcomponents-lite","./src/build-lite.json"),defineBuildTask("HTMLImports"),gulp.task("build",["webcomponents","webcomponents-lite","HTMLImports","copy-bower"]),gulp.task("release",function(e){isRelease=!0,runseq("build","audit",e)}),gulp.task("default",function(e){runseq("build","audit",e)});